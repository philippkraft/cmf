<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>cmf: Waterbalance Connections in CMF</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="cmf-logo-klein.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">cmf
   &#160;<span id="projectnumber">1.3.1b</span>
   </div>
   <div id="projectbrief">The Catchment Modelling Framework</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">index</a></li><li class="navelem"><a class="el" href="tutorial.html">Tutorial</a></li><li class="navelem"><a class="el" href="conceptual.html">Conceptual Models with CMF</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Waterbalance Connections in CMF </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>A waterbalance connection can be used to route water through a storage, while keeping the volume of the water in the storage constant. For example, this is used in the surfacewater of the cell. Every cell has a surface water storage, which is mainly used to route water. As it should not contain any water, except explicitly stated otherwise, the surface water is connected to the uppermost layer of the cell and all incoming fluxes are routed to the uppermost layer by a waterbalance connection.</p>
<p>Import all tools.</p>
<div class="fragment"><div class="line"><span class="keyword">import</span> cmf</div><div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div><div class="line"><span class="keyword">import</span> datetime</div></div><!-- fragment --><p>Create storages.</p>
<div class="fragment"><div class="line">p = <a class="code" href="classcmf_1_1project.html">cmf.project</a>()</div><div class="line">s1 = p.NewStorage(<span class="stringliteral">&quot;s1&quot;</span>, 0,0,0)</div><div class="line">s2 = p.NewStorage(<span class="stringliteral">&quot;s2&quot;</span>, 0,0,10)</div><div class="line">s3 = p.NewStorage(<span class="stringliteral">&quot;s3&quot;</span>, 0,0,20)</div><div class="line">s4 = p.NewStorage(<span class="stringliteral">&quot;s4&quot;</span>, 0,0,30)</div><div class="line">s5 = p.NewStorage(<span class="stringliteral">&quot;s5&quot;</span>, 0,0,40)</div></div><!-- fragment --><p>Create lists to store the data.</p>
<div class="fragment"><div class="line">flux_s1_to_s3 = [] flux_s2_to_s3 = []</div><div class="line">flux_s3_to_s4 = [] flux_s3_to_s5 = []</div></div><!-- fragment --><p>Install the fluxes. Here water is routed from s1 and s2 to s3 (both technical fluxes) and from s3 to s4 (technical flux) and s5 (waterbalance connection). The technical fluxes all have different intesities to make the easier to differentiate.</p>
<div class="fragment"><div class="line">cmf.TechnicalFlux(s1, s3, 10)</div><div class="line">cmf.TechnicalFlux(s2, s3, 5)</div><div class="line">cmf.waterbalance_connection(s3, s4)</div><div class="line">cmf.TechnicalFlux(s3, s5, 2.5)</div></div><!-- fragment --><p>Run the model and store all fluxes.</p>
<div class="fragment"><div class="line">solver = cmf.CVodeIntegrator(p)</div><div class="line"></div><div class="line">start = datetime.datetime(2017, 12, 1)</div><div class="line">end = datetime.datetime(2017, 12, 15)</div><div class="line"></div><div class="line"><span class="keywordflow">for</span> t <span class="keywordflow">in</span> solver.run(start, end, cmf.day):</div><div class="line">    flux_s1_to_s3.append(s1.flux_to(s3, t))</div><div class="line">    flux_s2_to_s3.append(s2.flux_to(s3, t))</div><div class="line">    flux_s3_to_s4.append(s3.flux_to(s4, t))</div><div class="line">    flux_s3_to_s5.append(s3.flux_to(s5, t))</div></div><!-- fragment --><p>Plot the fluxes.</p>
<div class="fragment"><div class="line">plt.plot(flux_s1_to_s3, label=<span class="stringliteral">&quot;Technical flux 10 m³&quot;</span>)</div><div class="line">plt.plot(flux_s2_to_s3, label=<span class="stringliteral">&quot;Technical flux 5 m³&quot;</span>)   </div><div class="line">plt.plot(flux_s3_to_s4, label=<span class="stringliteral">&quot;Waterbalance connection&quot;</span>)    </div><div class="line">plt.plot(flux_s3_to_s5, label=<span class="stringliteral">&quot;Technical flux 2.5 m³&quot;</span>)     </div><div class="line"></div><div class="line">plt.ylabel(<span class="stringliteral">&quot;Flux [m³/day]&quot;</span>) plt.xlabel(<span class="stringliteral">&quot;Time [days]&quot;</span>)</div><div class="line">plt.legend()</div></div><!-- fragment --><p>The resulting image should look something like this:</p>
<div class="image">
<img src="waterbalance_connection.png​"/>
</div>
<p>Here we can see how the different connections behave. Storage 3 gets water from storage 1 and 2 and looses water to storage 4 and 5. The connection from storage 3 to storage 4 is the waterbalance connection. The shape of this connections is shaped by the combination of the other connections. At start the waterbalance connection routes the most water, as it transports all incoming water (from storage 1 and storage 2) minus the outgoing water (to storage 5). After storage 2 runs dry, the waterbalance connection transports less water then the technical flux from storage 1 to storage 3, as now the waterbalance is: flux from storage 1 to storage 3 minus flux from storage 3 to storage 5. When storage 1 runs dry, the waterbalance connection does not transport water any more, as now all remaining water in storage 3 is routed to storage 5. </p>
</div></div><!-- contents -->
<hr class="footer"/><address class="footer"><small>
<div>&copy 2008-2017 by 
<a class="el" href="http://www.uni-giessen.de/hydro/kraft"> Philipp Kraft</a> and
<a class="el" href="http://www.uni-giessen.de/hydro"> 
Institute of Landscape Ecology and Resources Management,University of Gie&szlig;en</a>
</h3></td>
<td>Generated: Tue Jun 19 2018 16:35:15</td>
</tr></table>
</small></address>
</body>
</html>
