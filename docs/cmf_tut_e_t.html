<!-- HTML header for doxygen 1.8.14-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>cmf: Evapotranspiration</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="cmf-logo-2018.svg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
  <div id="projectnumber">1.6.0</div>
   <div id="projectbrief">catchment modelling framework</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('cmf_tut_e_t.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Evapotranspiration </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Several models exist to calculate water losses from the soil and surfaces to the atmosphere, and naming of processes and concepts is not completely fixed. Some definitions:</p>
<p><b>Evaporation</b> is the vaporization from a surface with no transition through a biologically active membrane. Evaporation is thus governed only by the physical environment.</p>
<p><b>Transpiration</b> is vaporization from a biological surface, steered by active opening and closing. For our cases only the transpiration of plants is of interest.</p>
<p>Many models for vaporization use the term "Evapotranspiration" which is the bulk sum of evaporation and transpiration, since soil evaporation and plant transpiration influence each other and are complex to differentiate. From the water storage perspective, the main difference is, that plants take up water from several soil layers (if the rooting zone is divided in serveral layers), but soil evaporation takes water from the first layer only (except for very, very dry regions), open water evaporation from <a class="el" href="classcmf_1_1river_1_1_open_water_storage.html">OpenWaterStorage</a> like surface water, rivers and lakes. Water that is intercepted by vegetation (see <a class="el" href="cmf_tut_intercept.html">next</a> tutorial) either percolates to the surface water or evaporates from the leaf surface. Since transpiration is the main part of bulk evapotranspiration in vegetated soils, models that deal only with bulk evapotranspiration handle the bulk flux as we would have transpiration only. However, by including a canopy water storage, interception of rain on the plant leaves can be considered.</p>
<h1>Potential bulk evapotranspiration</h1>
<p>Evapotranspiration is subject to many processes depending on vast amount of environmental conditions. To get a structure, one can differ between an energy limit and a water limitation. The energy limitation is expressed by the term <b>potential evapotranspiration</b> \(ET_{pot}\) the water that would be vaporized if enough water is available. \(ET_{pot}\) is determined by the surface structure (land cover) and meteorological conditions. If the surface structure is assumed to be a reference surface, (short, mown grass with defined properties), we get the <b>reference evapotranspiration</b> \(ET_{ref}\), which is depending on meteorological conditions only.</p>
<p>The <b>actual evapotranspiration</b> \(ET_{act}\) which is limited by water and energy, depends also on the soil moisture in the rooting zone and is usually calculated from \(ET_{pot}\) using a limiting factor. While you can use cmf to calculate \(ET_{act}\) from vegetation cover, meteorological conditions and soil moisture directly, using different models, one can also precalculate an \(ET_{pot}\) timeseries and cmf calculates \(ET_{act}\) from these values.</p>
<p>In the following, we use a simple lumped conceptual model with one cell, and a single soil layer, without any runoff. This model can be extended to create direct runoff or runoff via groundwater storages, as shown in the <a class="el" href="conceptual.html">next chapter</a> and <a class="el" href="cmf_tut_meteostation.html">connected to a rain station</a>. This tutorial is also mostly applicable to physical models with multiple layers in the root zone by making <a class="el" href="cmf_tut_e_tphys.html">assumptions about the root distribution in the soil</a>.</p>
<div class="fragment"><div class="line">from __future__ <span class="keyword">import</span> division, print_function</div><div class="line"><span class="keyword">import</span> cmf</div><div class="line"></div><div class="line"><span class="comment"># Create project with 1 cell and 1 water storage of 1000mm capacity</span></div><div class="line">p = <a class="code" href="classcmf_1_1project.html">cmf.project</a>()   </div><div class="line">cell = p.NewCell(0, 0, 0, 1000)</div><div class="line">layer = cell.add_layer(1.0)</div><div class="line"><span class="comment"># Put 200mm water into the soil, quite dry, good to show water stress </span></div><div class="line">layer.volume = 200.0</div></div><!-- fragment --><h2>Using precalculated \(ET_{pot}\) timeseries</h2>
<p>As a first step, you need to have your values stored in a <a class="el" href="cmf_tut_space_time.html">timeseries</a>, for the following code named ET. The timeseries needs to have the unit of mm/day. To get \(ET_{act}\), you will connect every soil layer in the rooting zone with the <code>transpiration</code> boundary condition of the cell with the <a class="el" href="classcmf_1_1upslope_1_1_e_t_1_1timeseries_e_tpot.html">timeseriesETpot</a> connection.</p>
<div class="fragment"><div class="line">ETpot = cmf.timeseries.from_scalar(5) <span class="comment"># constant ETpot of 20 mm/day (I know that this is too much)</span></div><div class="line"></div><div class="line"><span class="comment"># connect each layer with the transpiration boundary condition using ETpot</span></div><div class="line">et_pot_connection = cmf.timeseriesETpot(layer, cell.transpiration, ETpot)</div></div><!-- fragment --><h2>Calculating \(ET_{pot}\) from meteorological data</h2>
<p>Cells provide always weather information, by default they have an eternal spring day in central Europe. To change the weather of a cell dynamically you can use <a class="el" href="cmf_tut_meteostation.html">meteorological stations</a>, to change the weather of a cell to a static nice summer day one can do (Rs is global radiation in MJ/(m² day)):</p>
<div class="fragment"><div class="line">summer = cmf.Weather(Tmin=16, Tmax=28, rH=50, wind=1.0, sunshine=0.9, daylength=16, Rs=26)</div><div class="line">cell.set_weather(summer)</div></div><!-- fragment --><p>Or, if you prefer winter in Gießen: </p><div class="fragment"><div class="line">winter = cmf.Weather(Tmin=1, Tmax=2, rH=80, wind=6, sunshine=0.0, daylength=8, Rs=1.8)</div><div class="line">cell.set_weather(winter)</div></div><!-- fragment --><p>Which of the weather information is actually used to calculate \(ET_{pot}\) depends on the method. Currently the following methods to calculate \(ET_{pot}\) from the weather are available:</p>
<ul>
<li><a class="el" href="classcmf_1_1upslope_1_1_e_t_1_1_hargreave_e_t.html">cmf.HargreavesET</a>, using \(T_{min}, T_{max}\) and the day of year</li>
<li><a class="el" href="classcmf_1_1upslope_1_1_e_t_1_1_turc_e_t.html">cmf.TurcET</a>, using \(T, rH\) and global incoming radiation</li>
<li><a class="el" href="classcmf_1_1upslope_1_1_e_t_1_1_priestley_taylor_e_t.html">cmf.PriestleyTaylorET</a>, using net radiation and Temperature</li>
<li><a class="el" href="classcmf_1_1upslope_1_1_e_t_1_1_penman_monteith_e_t.html">cmf.PenmanMonteithET</a> with a high demand of atmospheric variables (see below)</li>
</ul>
<p>Using these evapotranspiration models works all the same, therefore it is only shown here for the Turc ET Method:</p>
<div class="fragment"><div class="line">et_pot_turc = cmf.TurcET(layer, cell.transpiration)</div><div class="line">print(layer.flux_to(cell.transpiration, datetime.datetime(2018, 1, 1)))</div></div><!-- fragment --><p>An <b>alternative</b> way to install connections between all existing soil layers and <code>cell.transpiration</code>: </p><div class="fragment"><div class="line">cell.install_connection(cmf.TurcET)</div></div><!-- fragment --><h1>Getting \(ET_{act}\) from \(ET_{pot}\)</h1>
<p>Low soil moisture limits actual transpiration, as it gets more and more difficult for a plant to extract soil moisture against a lower matrix potential.</p>
<h2>Physical description of water stress</h2>
<p>For physical models, where a soil layer is given a realistic retention curve, the stress can be directly described as a function of the matrix potential. This is possible in cmf, using a piecewise linear function of the matrix potential, known as the Feddes model. It is not possible for the model in this tutorial, since we are lacking a retention curve. The <a class="el" href="classcmf_1_1upslope_1_1_e_t_1_1_suction_stress.html">cmf.SuctionStress</a> model is used in <a class="el" href="cmf_tut_e_tphys.html">this later tutorial</a>, which covers physical models and transpiration.</p>
<h2>Conceptual description of water stress</h2>
<p>In conceptual cmf models, soil layers are just buckets of a certain size, in this tutorial a bucket with a capacity of 1000 mm. While the matrix potential of a layer is undefined, the water content has a defintion, the actual water volume V divided by the layer capacity C:</p>
<p class="formulaDsp">
\[ \theta = \frac{V_{layer}}{C_{layer}} \]
</p>
<p>An often used approach to describe water stress as a function of water content is to define a permanent wilting point \(\theta_{wp}\) and a water content above no stress occurs \(\theta_{d}\). The actual evapotranspiration from a soil is then described as:</p>
<p class="formulaDsp">
\[ ET_{act} = ET_{pot} \cdot \begin{cases} 1 &amp; \mbox{if } \theta &gt; \theta_d \\ \frac{\theta - \theta_{wp}}{\theta_d - \theta_{wp}} &amp; \mbox{if } \theta_{wp} &lt; \theta &lt; \theta_d \\ 0 &amp; \mbox{if } \theta &lt; \theta_{wp} \end{cases} \]
</p>
<p>This is obviously a crude linearization of the function using the matrix potential, hence the definition of \(\theta_d\) is not very precise. An often used approach in literature is to set it to the mean of wilting point and field capacity. This approach is called <a class="el" href="classcmf_1_1upslope_1_1_e_t_1_1_content_stress.html">cmf.ContentStress</a></p>
<p>This stress model can be applied to a cell by: </p><div class="fragment"><div class="line">cell.set_uptakestress(cmf.ContentStress(theta_d=0.3, theta_w=0.1))</div></div><!-- fragment --><p>However, to apply this function, the model needs to have a coherent meaning for the "capacity" of the root zone, which is for a simple Nash-Box model or a TOPMODEL like approach not necessarily the case. Instead of forcing the user to define a capacity only to calculate the stress function, water stress can also be calculated by the water volume stored in the layer using the <a class="el" href="classcmf_1_1upslope_1_1_e_t_1_1_volume_stress.html">cmf.VolumeStress</a>, which is the recommended stress function for simple, conceptual models.</p>
<h1>In code, please</h1>
<div class="image">
<img src="CmfTutET.png" alt="CmfTutET.png"/>
</div>
<p>To put all of this long tutorial together in few lines of code, the task is to write a model that calculates the remaining volume in a lysimeter with a reference surface (short grass), with the following assumptions:</p>
<ol type="1">
<li>Every day is a nice summer day, no rain (eg. Canaries)</li>
<li>The lysimeter is water tight</li>
<li>Evapotranspiration is calculated after Turc</li>
<li>Initial water volume is 400 mm</li>
<li>Evapotranspiration decreases if less then 300 mm are left in the lysimeter</li>
<li>Evapotranspiration stops if less then 100 mm are left</li>
</ol>
<div class="fragment"><div class="line"><span class="keyword">import</span> cmf</div><div class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime, timedelta</div><div class="line"><span class="keyword">from</span> pylab <span class="keyword">import</span> plot, twinx, ylabel, xlabel</div><div class="line"></div><div class="line"><span class="comment"># Create project with 1 cell and 1 water storage of 1000mm capacity</span></div><div class="line">p = <a class="code" href="classcmf_1_1project.html">cmf.project</a>()</div><div class="line">cell = p.NewCell(0, 0, 0, 1000)</div><div class="line">layer = cell.add_layer(1.0)</div><div class="line"></div><div class="line"><span class="comment"># Set summertime, when the living is easy... (1)</span></div><div class="line">summer = cmf.Weather(Tmin=19, Tmax=28, rH=50, wind=4.0,</div><div class="line">                     sunshine=0.9, daylength=14, Rs=26)</div><div class="line">cell.set_weather(summer)</div><div class="line"></div><div class="line"><span class="comment"># Initial condition (4)</span></div><div class="line">layer.volume = 400.0</div><div class="line"></div><div class="line"><span class="comment"># ET-Method (3)</span></div><div class="line">et_pot_turc = cmf.TurcET(layer, cell.transpiration)</div><div class="line"></div><div class="line"><span class="comment"># Stress conditions (5, 6)</span></div><div class="line">stress = cmf.VolumeStress(300, 100)</div><div class="line">cell.set_uptakestress(stress)</div><div class="line"></div><div class="line"><span class="comment"># A solver, any is fine, really</span></div><div class="line">solver = cmf.HeunIntegrator(p)</div><div class="line">solver.t = datetime(2018, 5, 1)</div><div class="line">et_act = cmf.timeseries(solver.t, cmf.day)</div><div class="line">volume = cmf.timeseries(solver.t, cmf.day)</div><div class="line"><span class="keywordflow">while</span> solver.t &lt; datetime(2018, 10, 1):</div><div class="line">    et_act.add(cell.transpiration(solver.t))</div><div class="line">    volume.add(layer.volume)</div><div class="line">    solver(cmf.day)</div><div class="line"></div><div class="line"><span class="comment"># And a plot</span></div><div class="line">plot(et_act, c=<span class="stringliteral">&#39;g&#39;</span>)</div><div class="line">ylabel(<span class="stringliteral">r&#39;$ET_{act} \left[\frac{mm}{day}\right]$&#39;</span>)</div><div class="line">twinx()</div><div class="line">plot(volume, c=<span class="stringliteral">&#39;b&#39;</span>)</div><div class="line">ylabel(<span class="stringliteral">&#39;Volume in mm&#39;</span>)</div></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<hr class="footer"/><address class="footer"><small>
<div>&copy 2008-2017 by 
<a class="el" href="http://www.uni-giessen.de/hydro/kraft"> Philipp Kraft</a> and
<a class="el" href="http://www.uni-giessen.de/hydro"> 
Institute of Landscape Ecology and Resources Management,University of Gie&szlig;en</a>
</h3></td>
<td>Generated: Sun Feb 9 2020 15:17:02</td>
</tr></table>
</small></address>
</body>
</html>
