<!-- HTML header for doxygen 1.8.3-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<title>cmf: $title</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
  <span id="projectlogo"><img alt="cmf - the catchment modelling framework" src="cmf-logo-klein.png"/></span>
  <span style="padding-left: 2em;">
   <span id="projectname">cmf
   &#160;<span id="projectnumber">1.2.1a0</span>
   </span>
   <span id="projectbrief">The Catchment Modelling Framework</span>
  </span>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="contents">
<div class="textblock"><p>index..</p>
<h1>Using simple infiltration in a lumped model</h1>
<p>As lumped models are a quite abstract realisation of a catchment, often a simplified kinematic wave approach is used to connect storages. Kinematic waves are sufficient for many different flux connections, but can lead to problems when trying to model infiltration. One way to model the infiltration in CMF is the <a href="http://fb09-pasig.umwelt.uni-giessen.de/cmf/chrome/site/doxygen/classcmf_1_1upslope_1_1connections_1_1_simple_infiltration.html">Simple Infiltration</a> approach.</p>
<h2>Hydrological concept</h2>
<p>a) Light rainfall on a dry soil: Incoming surface fluxes, like rain or snow melt, infiltrate immediately and completely when the soil is dry and the flux intensity is below infiltration capacity</p>
<p>b) Saturation excess: when the upper soil approaches saturation, only a portion of the incoming fluxes infiltrate, the surplus remains in the surfacewater storage and might be routed somewhere else. This accounts for large cells, as in lumped or semidistributed layers, where saturation does not need to be reached everywhere to result in surface runoff.</p>
<p>c) Infiltration excess: when the incoming flux gets higher than the saturated conductivity of the top soil layer, only the saturated conductivity in m/day infiltrates.</p>
<h2>Mathematical considerations</h2>
<p>For the approach we call the sum of incoming fluxes on the surface, like rain, snow melt, irrigation and dew \(\sum I\) in \(m^3/day\), and the effective infiltration rate \(Q_{inf}\) also in \(m^3/day\). The infiltration capacity of the soil is given as saturated conductivity \(K_{sat}\) in \(m/day\). The infiltration rate is therefore limited by \(K_{sat} A\), where \(A\) is the area of the cell.</p>
<p>To express the approach as an equation we get:</p>
<p class="formulaDsp">
\[ Q_{inf} = \left(1-e_{sat}\right) Q_{inf,pot} \]
</p>
<p>where:</p>
<p>- \(e_{sat}\) Saturation excess, ranging from 0 (nowhere saturated soil layer) to 1 (fully saturated). - <code>\form#581@_fakenl</code> is the potential infiltration, given by the incoming fluxes limited by the saturated conductivity.</p>
<p>For light enough rain ( \(\sum I &lt; K_{sat} A\)) on a dry soil, ( \(e_{sat}=0\)), the infiltration equals the incoming fluxes:</p>
<p class="formulaDsp">
\[ Q_{inf} = \sum I \]
</p>
<h3>Infiltration excess</h3>
<p>For very heavy rain or irrigation on a not well drained, but dry soil, eg. compacted, bare, sandy loam, we get:</p>
<p class="formulaDsp">
\[ \sum I &gt; K_{sat} A \rightarrow Q_{inf,pot} = K_{sat} A \rightarrow Q_{inf} = K_{sat}A \]
</p>
<p>but only for the time of the event.</p>
<h3>Saturation excess</h3>
<p>A naive formulation for the saturation excess is a binary swith. The receiving top soil is either full, and all the potential infiltration \(Q_{inf,pot}\) stays in the surface water and is eventually routed elsewhere, or, the top soil has space and all of \(Q_{inf,pot}\) goes into the soil. As an equation:</p>
<p class="formulaDsp">
\[ e_{sat} = 1 ,\ if\ W&gt;=1,\ else\ 0 \]
</p>
<p>Where \(W\) is the water filled porespace, or wetness. In conceptual models, this is expressed as stored volume per capacity \(V/C\).</p>
<p>This naive approach assumes a homogeneous state of saturated / unsaturated for the whole study region. This does not hold even for the patch scale with a micro relief and is certainly false for lumped models, where the topsoil layer represents the topsoil of a study area of thousands of kmÂ² and hundreds of m in height difference. To take hetereogeneity inside of the cell into account, we define \(e_{sat}\) as a continuous function of the top soil wetness \(W\). A sigmoidal function is both continuous and expresses a slow raise of surface overflow when the soil gets wetter and approaches a no infiltration limit for high soil wetness.</p>
<p>To gain an approach, that scales from patch to continental basins, the reaction is scaled by the parameter \(W_{1/2}\) that contains the wetness, at which half of the incoming water infiltrates, and half of the water stays back in the surface water. For the simple infiltration connection in cmf, we have chosen the Boltzmann function:</p>
<p class="formulaDsp">
\[ e_{sat}(W_{soil}, W_{1/2}) = -\frac{1}{1+e^{-1/5 \omega}} \\ \omega = (W - W_{1/2})\cdot (1 - W_{1/2}) \]
</p>
<p>For small scales with a sharp surface runoff response, one might choose \(W_{1/2} &gt; 0.9\) and for large and/or steep catchments lower values, down to \(W_{1/2}\approx 0.5\). The response is shown in the figure below.</p>
<div class="image">
<img src="examples/CmfTutSimpleInfiltration.png"/>
</div>
<p>The left figure shows the relative infiltration flux <code>\form#593@_fakenl</code> in terms of the wetness \(V/C\) for \(W_{1/2}=0.95\) (blue) and \(W_{1/2}=0.75\)(orange). The right figure shows the development of the infiltration \(Q_{inf}\) (solid line) and the saturation excess \(\sum I - Q_{inf}\) (dashed line) over time with a constant inflow of the topsoil capacity in one day day ( \(\sum I = C/day \)) starting with a complete dry soil ( \(W=0\)). The lower right figure shows the development of the soil water volume (solid line) and the surface water volume (dashed line) if no water is lost.</p>
<h2>Implementation in cmf</h2>
<p>To show the implementation, we are using the code of the right figure above, with \(W_{1/2}=0.9\)</p>
<h3>Setup up a cell</h3>
<div class="fragment"><div class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function, division</div><div class="line"><span class="keyword">import</span> cmf</div><div class="line"></div><div class="line">p = <a class="code" href="classcmf_1_1project.html">cmf.project</a>()</div><div class="line">c = p.NewCell(0,0,0,1000)</div><div class="line"></div><div class="line">c.surfacewater_as_storage()</div><div class="line">l=c.add_layer(1)</div></div><!-- fragment --><h3>Connect and adjust</h3>
<p><b>Note:</b> for simple infiltration the receiving node comes first, sorry.</p>
<div class="fragment"><div class="line">cmf.SimpleInfiltration(c.layers[0], c.surfacewater, W0=0.9)</div><div class="line"></div><div class="line"><span class="comment"># adjust the saturated conductivity in m/day.</span></div><div class="line">l.soil.Ksat = 1.0 <span class="comment"># 1000 mm/day infiltration capacity - quite a lot, but not extreme</span></div><div class="line"></div><div class="line"><span class="comment"># Set the constant rainfall to C[m3]/1 day</span></div><div class="line">c.set_rainfall(l.get_capacity())</div></div><!-- fragment --><h3>Integrate</h3>
<div class="fragment"><div class="line">solver = cmf.RKFIntegrator(p, 1e-9)</div><div class="line"></div><div class="line">I = c.get_rainfall(t)</div><div class="line"></div><div class="line">q_inf = [[c.surfacewater.flux_to(l,|t) / I]]</div><div class="line">inf_ex = [[c.surfacewater.waterbalance(t)|/ I]]</div><div class="line"></div><div class="line"><span class="keywordflow">for</span> t <span class="keywordflow">in</span> solver.run(solver.t, solver.t + cmf.day * 2, cmf.h):</div><div class="line">    q_inf.append(c.surfacewater.flux_to(l, t) / I)</div><div class="line">    inf_ex.append(c.surfacewater.waterbalance(t) / I)</div></div><!-- fragment --><h3>Plot</h3>
<div class="fragment"><div class="line"><span class="keyword">from</span> pylab <span class="keyword">import</span> plot</div><div class="line">plot(q_inf, <span class="stringliteral">&#39;-&#39;</span>)</div><div class="line">plot(inf_ex, <span class="stringliteral">&#39;--&#39;</span>)</div></div><!-- fragment --><p>author: philipp, version: 10 Fri Jan 19 15:37:54 2018 </p>
</div></div><!-- contents -->
<hr class="footer"/><address class="footer"><small>
<div>&copy 2008-2017 by 
<a class="el" href="http://www.uni-giessen.de/hydro/kraft"> Philipp Kraft</a> and
<a class="el" href="http://www.uni-giessen.de/hydro"> 
Institute of Landscape Ecology and Resources Management,University of Gie&szlig;en</a>
</h3></td>
<td>Generated: Mon Apr 9 2018 10:03:26</td>
</tr></table>
</small></address>
</body>
</html>
