<!-- HTML header for doxygen 1.8.14-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <meta name="generator" content="Doxygen 1.10.0"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>cmf: Surface runoff</title>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="dynsections.js"></script>
    <script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
    <script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
    <script type="text/javascript">
        DoxygenAwesomeDarkModeToggle.init()
        DoxygenAwesomeFragmentCopyButton.init()
    </script>
    <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
    <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
    <script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js"></script>
    <link href="doxygen.css" rel="stylesheet" type="text/css" />
    <link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="cmf-logo-2018.svg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
  <div id="projectnumber">2.0.0b10</div>
   <div id="projectbrief">catchment modelling framework</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('cmf_tut_surface_runoff.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Surface runoff</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="el" href="cmf_tut2d.html">next...</a></p>
<h1>Surface runoff</h1>
<h2>Surface water storage</h2>
<p>Cells can own a distinct storage for surface water, and usually this storage should exist. However, water that does not infiltrate directly might be routed to an outlet (model boundary), a river (see later part of the tutorial) or to the surface water of another cell.</p>
<p>The surface water of a cell has the class <a class="el" href="classcmf_1_1upslope_1_1_surface_water.html">SurfaceWater</a>, and can either be created directly withe the cell:</p>
<div class="fragment"><div class="line">cell = project.NewCell(x=0,y=0,z=0,area=1000,with_surfacewater=<span class="keyword">True</span>) </div>
</div><!-- fragment --><p>or afterwards, if the cell has not been created with surface water</p>
<div class="fragment"><div class="line">cell = project.NewCell(x=0,y=0,z=0,area=1000) </div>
<div class="line">cell.surfacewater_as_storage()</div>
</div><!-- fragment --><p>To route the water to the target, one can use conceptual connections like the <a class="el" href="classcmf_1_1water_1_1_waterbalance_flux.html">WaterbalanceFlux</a>, if you want to ensure the surfacewater to be empty at all time, the generic <a class="el" href="classcmf_1_1water_1_1_power_law_connection.html">PowerLawConnection</a> for or the <a class="el" href="classcmf_1_1upslope_1_1connections_1_1_kinematic_surface_runoff.html">KinematicSurfaceRunoff</a> for a more "physical" approach. This type of connection is deemed to be the "normal" case and the <a class="el" href="classcmf_1_1upslope_1_1_surface_water.html">SurfaceWater</a> exposes some properties to be used by that connection.</p>
<p>Using a <a class="el" href="classcmf_1_1upslope_1_1connections_1_1_diffusive_surface_runoff.html">diffusive wave</a>, where sinks can fill up and water flows over the topographic gradient, is not numerically challenging. There are solutions in cmf but they are beyond the scope of this tutorial. See the demo file <code>darcy_plain</code> and <code>parkinglot</code> for examples.</p>
<h2>Kinematic surface runoff</h2>
<p>Surface runoff in cmf is usually modelled using the kinematic wave approximation of the St. Vernant equation for sheet flow using Manning friction loss:</p>
<p class="formulaDsp">
\[
[q|= d\ w\ d^{2/3} \frac{\sqrt{\tan \beta}}{n} 86400 \frac{sec}{day}
\]
</p>
<p>]</p>
<p>where: - \(q\) is the surface flow in \(\frac{m^3}{day}\) - \(d\) is the "active" water depth in \(m\) - \(w\) is the width of the sheet flow - \(\tan \beta\) is the topographic slope - \(n\) is the Manning roughness</p>
<p>The "active" water depth is the average water depth where runoff starts. The idea behind a passive and an active water depth is, that prior to runof subscale sinks need to be filled up in form of puddles. Only when the puddles are filled, the runoff starts. The <a class="el" href="classcmf_1_1upslope_1_1_surface_water.html">SurfaceWater</a> storage has a property <code>puddledepth</code> to characterize the average water depth needed to fill up the puddles. If runoff starts, when 20% of the surface is covered by (on average) 1cm deep puddles, the <code>puddledepth</code> is \(0.01m \cdot 0.2
= 0.002m\). The property <code>nManning</code> of the <a class="el" href="classcmf_1_1upslope_1_1_surface_water.html">SurfaceWater</a> is also used.</p>
<h3>Example: A simple over flow routing to a boundary condition</h3>
<div class="fragment"><div class="line"><span class="keyword">import</span> cmf</div>
<div class="line"><span class="keyword">from</span> numpy <span class="keyword">import</span> transpose</div>
<div class="line"><span class="keyword">from</span> pylab <span class="keyword">import</span> plot,show,subplot</div>
<div class="line"> </div>
<div class="line">p = <a class="code hl_class" href="classcmf_1_1project.html">cmf.project</a>()</div>
<div class="line"><span class="comment"># Create cell with 1000m2 and surface water storage</span></div>
<div class="line">c = p.NewCell(0,0,1,1000,<span class="keyword">True</span>)</div>
<div class="line"><span class="comment"># Set puddle depth to 2mm</span></div>
<div class="line">c.surfacewater.puddledepth = 0.002</div>
<div class="line"><span class="comment"># Add a thick layer, low conductivity. Use Green-Ampt-Infiltration</span></div>
<div class="line">c.add_layer(0.1, cmf.VanGenuchtenMualem(Ksat=0.1))</div>
<div class="line">c.install_connection(cmf.GreenAmptInfiltration)</div>
<div class="line"><span class="comment"># Create outlet, 10 m from cell center, 1m below cell</span></div>
<div class="line">outlet = p.NewOutlet(<span class="stringliteral">&#39;outlet&#39;</span>,10,0,0)</div>
<div class="line"><span class="comment"># Create connection, distance is calculated from position</span></div>
<div class="line">con = cmf.KinematicSurfaceRunoff(c.surfacewater,outlet,flowwidth=10)</div>
<div class="line"><span class="comment"># set rainfall, a good shower to get surface runoff for sure (100mm/day)</span></div>
<div class="line">c.set_rainfall(100.)</div>
<div class="line"><span class="comment"># Create a solver</span></div>
<div class="line">solver = cmf.CVodeKrylov(p,1e-8)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Calculate results</span></div>
<div class="line">Vsoil, Vsurf, qsurf,qinf = transpose([(c.layers[0].volume, c.surfacewater.volume, outlet(t), c.layers[0](t)) </div>
<div class="line">                             <span class="keywordflow">for</span> t <span class="keywordflow">in</span> solver.run(cmf.Time(1,1,2012),cmf.Time(2,1,2012),cmf.min)])</div>
<div class="line"><span class="comment"># Present results</span></div>
<div class="line">ax1=subplot(211)</div>
<div class="line">plot(Vsurf,label=<span class="stringliteral">&#39;Surface&#39;</span>)</div>
<div class="line">plot(Vsoil,label=<span class="stringliteral">&#39;Soil&#39;</span>)</div>
<div class="line">ylabel(<span class="stringliteral">&#39;Water content in mm&#39;</span>)</div>
<div class="line">legend(loc=0)</div>
<div class="line">subplot(212,sharex=ax1)</div>
<div class="line">plot(qsurf,label=<span class="stringliteral">&#39;Surface&#39;</span>)</div>
<div class="line">plot(qinf,label=<span class="stringliteral">&#39;Soil&#39;</span>)</div>
<div class="line">ylabel(<span class="stringliteral">&#39;Flux in mm/day&#39;</span>)</div>
<div class="line">xlabel(<span class="stringliteral">&#39;Time in minutes&#39;</span>)</div>
<div class="line">legend(loc=0)</div>
<div class="ttc" id="aclasscmf_1_1project_html"><div class="ttname"><a href="classcmf_1_1project.html">cmf::project</a></div><div class="ttdoc">The study area, holding all cells, outlets and streams.</div><div class="ttdef"><b>Definition</b> project.h:53</div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<hr class="footer"/><address class="footer"><small>
<div>&copy 2008-2017 by 
<a class="el" href="http://www.uni-giessen.de/hydro/kraft"> Philipp Kraft</a> and
<a class="el" href="http://www.uni-giessen.de/hydro"> 
Institute of Landscape Ecology and Resources Management,University of Gie&szlig;en</a>
</h3></td>
<td>Generated: Fri Jan 19 2024 16:10:56</td>
</tr></table>
</small></address>
</body>
</html>
